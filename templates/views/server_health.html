<!-- 
Server Health HTML Template for WDC-GP/GUST-MARK-1
FIXED VERSION - Added missing 'view' class to resolve visibility issue
75% left (charts/health) / 25% right (commands)
-->

<div id="server-health" class="tab-content hidden view">
    <div class="flex flex-col lg:flex-row gap-4 p-4">
        
        <!-- LEFT SIDE: 75% width on desktop - Charts & Health Data -->
        <div class="flex-1 lg:w-3/4 space-y-4">
            
            <!-- Server Selection Dropdown (verified pattern) -->
            <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                <div class="flex items-center gap-3">
                    <span class="text-white font-semibold">üè• Server Health Monitor</span>
                    <select id="server-health-selector" class="flex-1 bg-gray-700 text-white p-2 rounded border border-gray-600 focus:border-purple-500 transition-colors">
                        <option value="">Select Server for Health Monitoring...</option>
                        <!-- Options populated by JavaScript -->
                    </select>
                    <button id="refresh-health-btn" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded transition-colors">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
            
            <!-- Health Status Cards (top row) - FIXED IDs -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                
                <!-- Overall Health Card -->
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center gap-2 mb-3">
                        <span id="health-indicator" class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                        <span class="text-white font-semibold">Server Health</span>
                    </div>
                    <p id="health-status-text" class="text-gray-300 text-sm mb-2">Checking status...</p>
                    <div class="w-full bg-gray-700 rounded-full h-2 mb-2">
                        <div id="health-progress-bar" class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p class="text-xs text-gray-500">Last check: <span id="last-health-check">--</span></p>
                </div>
                
                <!-- Response Time Card -->
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-yellow-400">‚ö°</span>
                        <span class="text-white font-semibold">Response Time</span>
                    </div>
                    <div class="flex items-end gap-2">
                        <span id="response-time-current" class="text-2xl font-bold text-white">--</span>
                        <span class="text-gray-400 text-sm">ms</span>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>24h avg: <span id="response-time-avg">--ms</span></span>
                        <span id="response-time-trend">‚û°Ô∏è</span>
                    </div>
                </div>
                
                <!-- Memory Usage Card -->
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-blue-400">üíæ</span>
                        <span class="text-white font-semibold">Memory Usage</span>
                    </div>
                    <div class="flex items-end gap-2">
                        <span id="memory-usage-current" class="text-2xl font-bold text-white">--</span>
                        <span class="text-gray-400 text-sm">MB</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2 mb-1">
                        <div id="memory-progress-bar" class="bg-blue-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500">
                        <span>24h avg: <span id="memory-usage-avg">--MB</span></span>
                        <span id="memory-usage-trend">‚û°Ô∏è</span>
                    </div>
                </div>
                
                <!-- CPU Usage Card - ADDED (was missing) -->
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="text-green-400">üñ•Ô∏è</span>
                        <span class="text-white font-semibold">CPU Usage</span>
                    </div>
                    <div class="flex items-end gap-2">
                        <span id="cpu-usage-current" class="text-2xl font-bold text-white">--</span>
                        <span class="text-gray-400 text-sm">%</span>
                    </div>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2 mb-1">
                        <div id="cpu-progress-bar" class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500">
                        <span>24h avg: <span id="cpu-usage-avg">--%</span></span>
                        <span id="cpu-usage-trend">‚û°Ô∏è</span>
                    </div>
                </div>
                
            </div>
            
            <!-- Performance Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                
                <!-- FPS Chart -->
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-white font-semibold flex items-center gap-2">
                            üìà FPS Performance
                        </h3>
                        <select id="fps-chart-period" class="bg-gray-700 text-white text-sm p-1 rounded">
                            <option value="6">6h</option>
                            <option value="12">12h</option>
                            <option value="24">24h</option>
                        </select>
                    </div>
                    <div class="relative h-48">
                        <canvas id="fps-chart" class="w-full h-full"></canvas>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-2">
                        <span>Current: <span id="fps-current" class="text-green-400">-- FPS</span></span>
                        <span>Avg: <span id="fps-average" class="text-gray-400">-- FPS</span></span>
                    </div>
                </div>
                
                <!-- Players Activity Chart -->
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-white font-semibold flex items-center gap-2">
                            üë• Player Activity
                        </h3>
                        <select id="players-chart-period" class="bg-gray-700 text-white text-sm p-1 rounded">
                            <option value="6">6h</option>
                            <option value="12">12h</option>
                            <option value="24">24h</option>
                        </select>
                    </div>
                    <div class="relative h-48">
                        <canvas id="players-chart" class="w-full h-full"></canvas>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-2">
                        <span>Online: <span id="players-current" class="text-blue-400">-- players</span></span>
                        <span>Peak: <span id="players-peak" class="text-gray-400">-- players</span></span>
                    </div>
                </div>
                
            </div>
            
            <!-- Performance Trends Section - UPDATED IDs -->
            <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-white font-semibold flex items-center gap-2">
                        üìä Performance Trends & Averages
                    </h3>
                    <div class="flex gap-2">
                        <button id="trends-24h-btn" class="bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700 transition-colors">
                            24h
                        </button>
                        <button id="trends-7d-btn" class="bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-500 transition-colors">
                            7d
                        </button>
                    </div>
                </div>
                
                <!-- Performance Metrics Grid - UPDATED IDs to match JavaScript expectations -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                    
                    <!-- Response Time Trend - FIXED TO MATCH ORIGINAL TEMPLATE -->
                    <div class="bg-gray-700 rounded p-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm">Response Time:</span>
                            <div class="text-right">
                                <div class="text-white font-medium" id="trends-response-current">--ms</div>
                                <div class="text-xs text-gray-500">
                                    vs avg: <span id="trends-response-change" class="text-gray-400">--%</span>
                                    <span id="trends-response-indicator" class="ml-1">‚û°Ô∏è</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Memory Trend - FIXED TO MATCH ORIGINAL TEMPLATE -->
                    <div class="bg-gray-700 rounded p-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm">Memory Usage:</span>
                            <div class="text-right">
                                <div class="text-white font-medium" id="trends-memory-current">--MB</div>
                                <div class="text-xs text-gray-500">
                                    vs avg: <span id="trends-memory-change" class="text-gray-400">--%</span>
                                    <span id="trends-memory-indicator" class="ml-1">‚û°Ô∏è</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CPU Trend - FIXED TO MATCH ORIGINAL TEMPLATE -->
                    <div class="bg-gray-700 rounded p-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm">CPU Usage:</span>
                            <div class="text-right">
                                <div class="text-white font-medium" id="trends-cpu-current">--%</div>
                                <div class="text-xs text-gray-500">
                                    vs avg: <span id="trends-cpu-change" class="text-gray-400">--%</span>
                                    <span id="trends-cpu-indicator" class="ml-1">‚û°Ô∏è</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Players Trend - FIXED TO MATCH ORIGINAL TEMPLATE -->
                    <div class="bg-gray-700 rounded p-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-400 text-sm">Player Count:</span>
                            <div class="text-right">
                                <div class="text-white font-medium" id="trends-players-current">--</div>
                                <div class="text-xs text-gray-500">
                                    vs avg: <span id="trends-players-change" class="text-gray-400">--%</span>
                                    <span id="trends-players-indicator" class="ml-1">‚û°Ô∏è</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
                <!-- Additional Metrics Row -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mt-4 pt-4 border-t border-gray-600">
                    
                    <!-- Server Uptime -->
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400 text-sm">Server Uptime:</span>
                        <div class="text-right">
                            <div class="text-green-400 font-medium" id="server-uptime">--h --m</div>
                            <div class="text-xs text-gray-500">Since last restart</div>
                        </div>
                    </div>
                    
                    <!-- Command Success Rate -->
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400 text-sm">Command Success:</span>
                        <div class="text-right">
                            <div class="text-green-400 font-medium" id="command-success-rate">--%</div>
                            <div class="text-xs text-gray-500">24h commands</div>
                        </div>
                    </div>
                    
                    <!-- Peak Memory Time -->
                    <div class="flex justify-between items-center">
                        <span class="text-gray-400 text-sm">Peak Memory:</span>
                        <div class="text-right">
                            <div class="text-white font-medium" id="peak-memory-value">--MB</div>
                            <div class="text-xs text-gray-500">
                                at <span id="peak-memory-time">--:--</span>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
                <!-- Trend Indicators Legend -->
                <div class="mt-4 pt-3 border-t border-gray-600">
                    <div class="flex items-center justify-center gap-6 text-xs text-gray-500">
                        <span class="flex items-center gap-1">
                            <span class="text-green-400">üìà</span> Improved
                        </span>
                        <span class="flex items-center gap-1">
                            <span class="text-red-400">üìâ</span> Declined
                        </span>
                        <span class="flex items-center gap-1">
                            <span class="text-gray-400">‚û°Ô∏è</span> Stable
                        </span>
                    </div>
                </div>
                
            </div>
            
        </div>
        
        <!-- RIGHT SIDE: 25% width - COMMAND COLUMN -->
        <div class="lg:w-1/4 bg-gray-800 rounded-lg border border-gray-700 flex flex-col">
            
            <!-- Command Column Header -->
            <div class="p-4 border-b border-gray-700">
                <h3 class="text-white font-semibold flex items-center gap-2 mb-3">
                    üîß Commands (24h)
                </h3>
                
                <!-- Filter Buttons -->
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <button id="filter-all-btn" class="filter-btn bg-purple-600 text-white px-2 py-1 rounded text-xs hover:bg-purple-700 transition-colors">
                        All
                    </button>
                    <button id="filter-admin-btn" class="filter-btn bg-gray-600 text-white px-2 py-1 rounded text-xs hover:bg-gray-500 transition-colors">
                        Admin
                    </button>
                    <button id="filter-ingame-btn" class="filter-btn bg-gray-600 text-white px-2 py-1 rounded text-xs hover:bg-gray-500 transition-colors">
                        In-game
                    </button>
                    <button id="filter-auto-btn" class="filter-btn bg-gray-600 text-white px-2 py-1 rounded text-xs hover:bg-gray-500 transition-colors">
                        Auto
                    </button>
                </div>
                
                <!-- Command Statistics -->
                <div class="text-xs text-gray-400">
                    Total: <span id="command-total-count" class="text-white">0</span> commands
                </div>
            </div>
            
            <!-- Command Feed (Scrollable) -->
            <div id="command-feed" class="flex-1 overflow-y-auto p-4 space-y-2 max-h-96 lg:max-h-full">
                
                <!-- Loading State -->
                <div id="command-loading" class="text-center text-gray-500 py-8">
                    <div class="animate-spin w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full mx-auto mb-2"></div>
                    <p class="text-sm">Loading commands...</p>
                </div>
                
                <!-- Empty State -->
                <div id="command-empty" class="text-center text-gray-500 py-8 hidden">
                    <span class="text-2xl mb-2 block">üìù</span>
                    <p class="text-sm">No commands in last 24h</p>
                    <p class="text-xs mt-1">Commands will appear here when executed</p>
                </div>
                
                <!-- Command entries will be populated by JavaScript -->
                <!-- Example format:
                <div class="command-entry text-xs p-2 bg-gray-700 rounded mb-2" data-command-type="admin">
                    <div class="flex justify-between items-start">
                        <span class="text-green-400">[15:30:22] save</span>
                        <span class="text-purple-400 text-xs">‚úì Admin</span>
                    </div>
                </div>
                -->
                
            </div>
            
            <!-- Command Feed Footer -->
            <div class="p-3 border-t border-gray-700 text-xs text-gray-500">
                <div class="flex justify-between items-center">
                    <span>Auto-refresh: <span id="refresh-countdown" class="text-white">30s</span></span>
                    <button id="manual-refresh-commands" class="text-purple-400 hover:text-purple-300 transition-colors">
                        üîÑ
                    </button>
                </div>
            </div>
            
        </div>
        
    </div>
    
    <!-- Loading Overlay for Server Health -->
    <div id="server-health-loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <div class="flex items-center gap-3">
                <div class="animate-spin w-6 h-6 border-2 border-purple-500 border-t-transparent rounded-full"></div>
                <span class="text-white">Loading server health data...</span>
            </div>
        </div>
    </div>
    
    <!-- Error Modal for Server Health -->
    <div id="server-health-error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 max-w-md">
            <div class="flex items-center gap-3 mb-4">
                <span class="text-red-400 text-xl">‚ö†Ô∏è</span>
                <h3 class="text-white font-semibold">Server Health Error</h3>
            </div>
            <p id="server-health-error-message" class="text-gray-300 mb-4">
                An error occurred while loading server health data.
            </p>
            <div class="flex gap-2 justify-end">
                <button id="server-health-error-retry" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded transition-colors">
                    Retry
                </button>
                <button id="server-health-error-close" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded transition-colors">
                    Close
                </button>
            </div>
        </div>
    </div>
    
</div>

<!-- Custom CSS for Server Health Layout -->
<style>
/* Server Health specific styles */
#server-health .filter-btn.active {
    background-color: rgb(147, 51, 234); /* purple-600 */
}

#server-health .command-entry {
    transition: all 0.2s ease;
}

#server-health .command-entry:hover {
    background-color: rgb(55, 65, 81); /* gray-600 */
    transform: translateX(2px);
}

/* Chart containers responsive */
#server-health canvas {
    max-height: 200px;
}

/* Scrollbar styling for command feed */
#command-feed::-webkit-scrollbar {
    width: 4px;
}

#command-feed::-webkit-scrollbar-track {
    background: rgb(55, 65, 81); /* gray-600 */
    border-radius: 2px;
}

#command-feed::-webkit-scrollbar-thumb {
    background: rgb(147, 51, 234); /* purple-600 */
    border-radius: 2px;
}

#command-feed::-webkit-scrollbar-thumb:hover {
    background: rgb(126, 34, 206); /* purple-700 */
}

/* Performance trends button states */
#trends-24h-btn.active {
    background-color: rgb(147, 51, 234); /* purple-600 */
}

#trends-7d-btn.active {
    background-color: rgb(147, 51, 234); /* purple-600 */
}

/* Mobile responsive adjustments */
@media (max-width: 1024px) {
    #server-health .flex-col.lg\\:flex-row {
        flex-direction: column;
    }
    
    #server-health .lg\\:w-3\\/4,
    #server-health .lg\\:w-1\\/4 {
        width: 100%;
    }
    
    #command-feed {
        max-height: 300px;
    }
}

/* Animation for health indicator */
@keyframes health-pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}

#health-indicator.pulse {
    animation: health-pulse 2s infinite;
}

/* Status color classes */
.status-healthy {
    color: rgb(34, 197, 94); /* green-500 */
}

.status-warning {
    color: rgb(245, 158, 11); /* yellow-500 */
}

.status-critical {
    color: rgb(239, 68, 68); /* red-500 */
}

.status-error {
    color: rgb(156, 163, 175); /* gray-400 */
}
</style>